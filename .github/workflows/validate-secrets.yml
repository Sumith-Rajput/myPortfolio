name: Validate Secrets Configuration

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  validate-secrets:
    name: Validate Required Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Check Required Secrets
        run: |
          echo "ğŸ” Validating GitHub Secrets Configuration..."
          echo ""
          
          # Check if secrets are set (they won't show values for security)
          secrets=(
            "AZURE_WEBAPP_NAME"
            "AZURE_RESOURCE_GROUP"
            "AZURE_CREDENTIALS"
            "AZURE_STATIC_WEB_APPS_API_TOKEN"
            "VITE_API_URL"
          )
          
          missing_secrets=()
          
          for secret in "${secrets[@]}"; do
            if [ -z "${!secret}" ]; then
              echo "âŒ $secret is not set"
              missing_secrets+=("$secret")
            else
              echo "âœ… $secret is configured"
            fi
          done
          
          if [ ${#missing_secrets[@]} -eq 0 ]; then
            echo ""
            echo "âœ… All required secrets are configured!"
            echo "ğŸš€ Your deployment workflows are ready to use."
          else
            echo ""
            echo "âš ï¸  Missing secrets: ${missing_secrets[*]}"
            echo "ğŸ“ Please add these secrets in: Settings â†’ Secrets and variables â†’ Actions"
            exit 1
          fi
        env:
          AZURE_WEBAPP_NAME: ${{ secrets.AZURE_WEBAPP_NAME }}
          AZURE_RESOURCE_GROUP: ${{ secrets.AZURE_RESOURCE_GROUP }}
          AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
          AZURE_STATIC_WEB_APPS_API_TOKEN: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          VITE_API_URL: ${{ secrets.VITE_API_URL }}

      - name: Validate Azure Credentials Format
        if: secrets.AZURE_CREDENTIALS
        run: |
          echo "ğŸ” Validating AZURE_CREDENTIALS format..."
          # This is a basic check - credentials should be JSON
          if echo "${{ secrets.AZURE_CREDENTIALS }}" | jq empty 2>/dev/null; then
            echo "âœ… AZURE_CREDENTIALS format is valid JSON"
          else
            echo "âš ï¸  AZURE_CREDENTIALS might not be valid JSON"
            echo "   Expected format: {\"clientId\":\"...\",\"clientSecret\":\"...\",\"subscriptionId\":\"...\",\"tenantId\":\"...\"}"
          fi
        continue-on-error: true

      - name: Display Configuration Summary
        run: |
          echo ""
          echo "ğŸ“‹ Configuration Summary:"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Backend App Service: ${{ secrets.AZURE_WEBAPP_NAME || 'Not set' }}"
          echo "Resource Group: ${{ secrets.AZURE_RESOURCE_GROUP || 'Not set' }}"
          echo "Frontend API URL: ${{ secrets.VITE_API_URL || 'Not set' }}"
          echo "Static Web App Token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN && 'âœ… Set' || 'âŒ Not set' }}"
          echo "Azure Credentials: ${{ secrets.AZURE_CREDENTIALS && 'âœ… Set' || 'âŒ Not set' }}"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ’¡ Next Steps:"
          echo "   1. If all secrets are set, you can trigger deployment"
          echo "   2. Push to main branch or run 'Deploy Portfolio App' workflow manually"
          echo "   3. Monitor deployment in Actions tab"

